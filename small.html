<html> <head> <script>var rules;!function(e){var t=function(e,t){return null==e?t():e},r=function(){function e(e,t){this.size=e,this.contents=[];for(var r=0;r<e.x;r++){for(var n=[],o=0;o<e.y;o++)n.push(t(new i(r,o)));this.contents.push(n)}}return e.prototype.get=function(e){return this.isValidVector(e)?this.contents[e.x][e.y]:null},e.prototype.unsafeSet=function(e,t){this.contents[e.x][e.y]=t},e.prototype.isValidVector=function(e){var t=this.size;return e.x>=0&&e.y>=0&&e.x<t.x&&e.y<t.y},e.prototype.recreate=function(t){return new e(this.size,t)},e.duplicate=function(t,r){return null==t?null:new e(i.duplicate(t.size),function(e){return r(t.get(e))})},e.eq=function(e,t,r){if(!i.eq(e.size,t.size))return!1;for(var n=e.size,o=0;o<n.x;o++)for(var l=0;l<n.y;l++){var a=new i(o,l);if(!r(e.get(a),t.get(a)))return!1}return!0},e}();e.Layer=r;var i=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.neighbors=function(t){return void 0===t&&(t=!1),[new e(this.x+1,this.y),new e(this.x,this.y+1),new e(this.x-1,this.y),new e(this.x,this.y-1)]},e.duplicate=function(t){return new e(t.x,t.y)},e.eq=function(e,t){return e.x==t.x&&e.y==t.y},e}();e.Vec2=i;var n=function(){function e(e,t){this.current=e,this.original=t}return e.deplete=function(t){if(null==t)return null;var r=e.duplicate(t);return r.current--,r},e.ignore=function(e){return e},e.undeplete=function(t){if(null==t)return null;var r=e.duplicate(t);return r.current++,r.original++,r},e.duplicate=function(t){return null==t?null:new e(t.current,t.original)},e.mayMove=function(e){return!(null!=e&&0==e.current)},e.ignoreMayMove=function(e){return!0},e}();e.Pie=n,function(e){e[e.Black=0]="Black",e[e.White=1]="White"}(e.Player||(e.Player={}));var o=e.Player,l=function(){function e(){}return e.eq=function(e,t){return e==t},e.opposite=function(e){if(null==e)throw"the null player has no opposite";return e==o.Black?o.White:o.Black},e}();e.Players=l,function(e){e[e.BadPosition=0]="BadPosition",e[e.AlreadyPlayed=1]="AlreadyPlayed",e[e.PieEmpty=2]="PieEmpty",e[e.DuplicateBoard=3]="DuplicateBoard"}(e.BoardFailureReason||(e.BoardFailureReason={}));var a=e.BoardFailureReason,s=function(){function s(e,n,l,a,s){if(void 0===l&&(l=o.Black),void 0===a&&(a=null),void 0===s&&(s=null),this.title=e,this.size=n,this.nextPlayer=l,this.owners=t(a,function(){return new r(n,function(e){return null})}),this.pies=t(s,function(){return new r(n,function(e){return null})}),a&&!i.eq(this.owners.size,n))throw"invalidly-sized owners layer";if(s&&!i.eq(this.pies.size,n))throw"invalidly-sized pies layer"}return s.fromBuilder=function(e,t,i,n){void 0===i&&(i=o.Black);var l=new r(t,function(e){return n(e)[0]}),a=new r(t,function(e){return n(e)[1]});return new s(e,t,i,l,a)},s.duplicate=function(e){return new s(e.title,e.size,e.nextPlayer,r.duplicate(e.owners,function(e){return e}),r.duplicate(e.pies,function(e){return n.duplicate(e)}))},s.play=function(t,i,n,o){void 0===n&&(n=e.Pie.mayMove),void 0===o&&(o=e.Pie.deplete);var u=t.nextPlayer;if(!t.pies.isValidVector(i))return a.BadPosition;var c=t.pies.get(i);if(!n(c))return a.PieEmpty;var h=t.owners.get(i);if(null!=h)return a.AlreadyPlayed;var f=s.duplicate(t);f.owners.unsafeSet(i,u),f.pies.unsafeSet(i,o(f.pies.get(i)));var p=f.owners;return[l.opposite(u),u].forEach(function(e){i.neighbors().concat([i]).forEach(function(t){p=s.tryToKill(p,e,t)})}),f.owners=p,r.eq(f.owners,t.owners,l.eq)?a.DuplicateBoard:(f.nextPlayer=l.opposite(t.nextPlayer),f)},s.tryToKill=function(e,t,r){return s.tryToKill_(e,t,[r])},s.tryToKill_=function(e,t,n){for(var o=[],a=[],s=function(){var r=n.pop();if(!e.isValidVector(r))return"continue";if(!o.every(function(e){return!i.eq(e,r)}))return"continue";o.push(r);var s=e.get(r);return s==l.opposite(t)?"continue":null==s?{value:e}:void(a.every(function(e){return!i.eq(e,r)})&&(a.push(r),r.neighbors().forEach(function(e){n.every(function(t){return!i.eq(t,e)})&&n.push(e)})))};0!=n.length;){var u=s();if("object"==typeof u)return u.value}if(0==a.length)return e;var c=r.duplicate(e,function(e){return e});return a.forEach(function(e){return c.unsafeSet(e,null)}),c},s.prototype.spec=function(t){for(var r=[],i=0;i<this.size.y;i++){for(var n=[],l=0;l<this.size.x;l++){var a=new e.Vec2(l,i),s="",u=this.owners.get(a),c=this.pies.get(a);s+=null==c?"-":c.original,s+=null==u?"-":u==o.Black?"B":"W",n.push(s)}r.push(" "+JSON.stringify(n))}return"boardBuilding.loadBoard("+JSON.stringify(t)+",\n"+r.join(",\n")+"\n)"},s}();e.Board=s}(rules||(rules={}));var gen;!function(e){var t=function(){function e(e,t,r,i,n,o){this.factionDiff=e,this.destructionDiff=t,this.pieExcitement=r,this.pruneMaxPercent=i,this.pruneZeroPercent=n,this.pruneNonzeroPercent=o}return e.Easy=new e(2,2,-2,.5,.7,.5),e.Medium=new e(2,-2,.8,.4,.7,.3),e.Hard=new e(4,8,8,.5,.7,.2),e}();e.Difficulty=t;var r=function(){function e(){}return e.generate=function(r,i){void 0===i&&(i=t.Medium);for(var n=e.mostPromising(r,[new rules.Board("RNG",r)],e.scoreInit,function(e){return!0},rules.Pie.ignoreMayMove,rules.Pie.ignore),o=0;o<r.x;o++)for(var l=0;l<r.y;l++)n.pies.unsafeSet(new rules.Vec2(o,l),new rules.Pie(0,0));for(var a=e.mostPromising(r,[n],e.scoreMove(i),function(t){return e.playablePieExcitement(t)>0},rules.Pie.ignoreMayMove,rules.Pie.undeplete),s=Math.floor(i.pruneZeroPercent*r.x*r.y),o=0;o<r.x;o++)for(var l=0;l<r.y&&!(0>=s);l++)0==a.pies.get(new rules.Vec2(o,l)).original&&Math.random()<i.pruneZeroPercent&&(a.pies.unsafeSet(new rules.Vec2(o,l),null),s--);for(var o=0;o<r.x;o++)for(var l=0;l<r.y&&!(0>=s);l++){var u=new rules.Vec2(o,l),c=a.pies.get(u);Math.random()<i.pruneNonzeroPercent&&null!=c&&c.current<=1&&(a.pies.unsafeSet(u,null),e.playablePieExcitement(a)<=0?a.pies.unsafeSet(new rules.Vec2(o,l),null):s--)}var h=rules.Board.duplicate(n);if(h.pies=a.pies,h.nextPlayer==rules.Player.White){h.nextPlayer=rules.Player.Black;for(var o=0;o<r.x;o++)for(var l=0;l<r.y;l++){var f=new rules.Vec2(o,l),p=h.owners.get(f);null!=p&&h.owners.unsafeSet(f,rules.Players.opposite(p))}}return console.log("RNG puzzle: \n"+h.spec("RNG")),h},e.mostPromising=function(t,r,i,n,o,l){for(var a=0,s=r.map(function(e){return{score:0,board:e}}),u=function(){if(0==s.length)throw"cannot pick boards with no boards to pick from";var t=s.filter(function(e){return n(e.board)});s.forEach(function(e){var r=e.board,s=rules.Board.play(r,new rules.Vec2(Math.floor(r.size.x*Math.random()),Math.floor(r.size.y*Math.random())),o,l);if(s.constructor!=rules.Board)return void a++;var u=s;n(u)&&t.push({score:-i(u,r,e.score),board:u})}),e.shuffle(t),t.sort(function(e,t){return e.score>t.score?1:e.score<t.score?-1:0}),0==t.length?a++:s=t.slice(0,15),a++};a<47*t.x*t.y;)u();return s[0].board},e.scoreMove=function(t){return function(r,i,n){var o=e.pieceCount(r),l=e.pieceCount(i),a=-Math.abs(e.pieceCount(r,rules.Player.Black)-e.pieceCount(r,rules.Player.White)),s=e.playablePieExcitement(r),u=a*t.factionDiff+Math.abs(o-l)*t.destructionDiff+s*t.pieExcitement;return u+.5*n}},e.scoreInit=function(t,r,i){return-Math.abs(e.pieceCount(t,rules.Player.Black)-e.pieceCount(t,rules.Player.White))},e.pieceCount=function(e,t){void 0===t&&(t=null);for(var r=0,i=0;i<e.size.x;i++)for(var n=0;n<e.size.y;n++){var o=e.owners.get(new rules.Vec2(i,n));(null!=o||null!=t&&o==t)&&r++}return r},e.countPlayable=function(e){for(var t=0,r=0;r<e.size.x;r++)for(var i=0;i<e.size.y;i++)rules.Board.play(e,new rules.Vec2(r,i)).constructor==rules.Board&&t++;return t},e.playablePieExcitement=function(e){for(var t=0,r=0;r<e.size.x;r++)for(var i=0;i<e.size.y;i++){var n=e.pies.get(new rules.Vec2(r,i));null!=n&&(t+=Math.pow(n.original,2))}return t},e.shuffle=function(e){var t=0,r=0,i=null;for(t=e.length-1;t>0;t-=1)r=Math.floor(Math.random()*(t+1)),i=e[t],e[t]=e[r],e[r]=i},e}();e.Generator=r}(gen||(gen={}));var uiModel;!function(e){var t=function(){function e(){}return e.forPlayerState=function(e,t){var r;if(e==rules.Player.White)r={colorBg:"#000",strokeBlankSpot:"#333",strokeOuterBorder:"#222",fillPieSlice:"#04f",strokePieSlice:"#04f",strokeDeadPieSlice:"#bb0",strokeBlack:"#fff",fillBlack:"#000",strokeWhite:"#fff",fillWhite:"#fff",strokeFriendEdge:"#444",strokeEnemyEdge:"#04f"};else{if(e!=rules.Player.Black)throw"no scheme for the null player";r={colorBg:"#fff",strokeBlankSpot:"#ddd",strokeOuterBorder:"#eee",fillPieSlice:"#f40",strokePieSlice:"#f40",strokeDeadPieSlice:"#bb0",strokeBlack:"#000",fillBlack:"#000",strokeWhite:"#000",fillWhite:"#fff",strokeFriendEdge:"#ddd",strokeEnemyEdge:"#f40"}}return t!=i.NotCompleted&&(r.strokeBlankSpot=r.strokeDeadPieSlice,r.strokeBlack="#fff",r.fillBlack="#000",r.strokeWhite="#000",r.fillWhite="#fff",t==i.Succeeded&&(r.strokeOuterBorder="#ee4",r.colorBg="#ee4"),t==i.Failed&&(r.strokeBlack="#f99",r.strokeOuterBorder="#f40",r.strokePieSlice="#ff0",r.strokeDeadPieSlice="#000",r.colorBg="#f40"),r.strokeEnemyEdge=r.strokeWhite,r.strokeFriendEdge=r.strokeWhite),r},e}();e.Schemes=t;var r=function(){function e(){this.mousedOver=!1,this.diesNextTurn=!1,this.unplayableReason=null,this.blowUp=1,this.jitterX=0,this.bounceY=0,this.bounceDy=0}return e.prototype.mouseOver=function(){this.mousedOver=!0},e.prototype.mouseOut=function(){this.mousedOver=!1},e.prototype.markUnplayableReason=function(e){this.unplayableReason=e},e.prototype.advance=function(){var e,t=!1;if(this.mousedOver&&null==this.unplayableReason?(e=1.5,t=!0):e=1,this.mousedOver&&null!=this.unplayableReason)switch(this.unplayableReason){case rules.BoardFailureReason.PieEmpty:this.jitterX=2*(Math.random()-.5)/100;break;case rules.BoardFailureReason.DuplicateBoard:e=.5;break;case rules.BoardFailureReason.AlreadyPlayed:case rules.BoardFailureReason.BadPosition:}t?(this.bounceGoingUp?this.bounceDy=-.1:this.bounceDy+=.01,this.bounceY+=this.bounceDy,this.bounceY<=-.5?(this.bounceY=-.5,this.bounceGoingUp=!1):this.bounceY>=.5&&(this.bounceY=.5,this.bounceDy=0,this.bounceGoingUp=!0)):this.bounceY=0,this.blowUp>e&&(this.blowUp-=.1),this.blowUp<e&&(this.blowUp+=.1),0==Math.abs(this.blowUp-e)&&(this.blowUp=e)},e}();e.TileState=r,function(e){e[e.NotCompleted=0]="NotCompleted",e[e.Succeeded=1]="Succeeded",e[e.Failed=2]="Failed"}(e.CompleteState||(e.CompleteState={}));var i=e.CompleteState,n=function(){function e(e){this.current=e,this.previous=e,this.tileStates=new rules.Layer(e.size,function(e){return new r}),this.completeState=this.checkCompleteState(),this.uiGlobals={clipCenter:new rules.Vec2(.5,.5),clipSize:1,completedTicks:0}}return e.prototype.checkCompleteState=function(){for(var e=!1,t=0;t<this.current.size.x;t++)for(var r=0;r<this.current.size.y;r++){var n=this.current.pies.get(new rules.Vec2(t,r));if(null!=n&&0!=n.current){e=!0;break}}var o=!1;if(this.tileStates)for(var t=0;t<this.current.size.x;t++)for(var r=0;r<this.current.size.y;r++){var l=this.tileStates.get(new rules.Vec2(t,r));if(null==l.unplayableReason){o=!0;break}}return e?o?i.NotCompleted:i.Failed:i.Succeeded},e.prototype.update=function(e){if("Tick"==e)this.advanceTileStates(),this.advanceUIGlobals();else if("MouseOver"==e[0]){var t=e[1];if(this.completeState!=i.NotCompleted)return;this.recalculateTileStates(t)}else if("Click"==e[0]){if(this.completeState!=i.NotCompleted)return;var r=e[1],n=e[2],o=rules.Board.play(this.current,r);if(o.constructor!=rules.Board)return;this.uiGlobals.clipCenter=n,this.uiGlobals.clipSize=.05,this.previous=this.current,this.current=o,this.previous=rules.Board.duplicate(this.previous),this.previous.owners.unsafeSet(r,this.current.owners.get(r)),this.recalculateTileStates(r),this.completeState=this.checkCompleteState()}},e.prototype.recalculateTileStates=function(e){var t=this,r=this.current,n=rules.Board.play(this.current,e);n.constructor==rules.Board&&(r=n),this.tileStates=this.tileStates.recreate(function(n){var o=t.tileStates.get(n);return t.completeState==i.NotCompleted&&!o.mousedOver&&rules.Vec2.eq(n,e)&&o.mouseOver(),!o.mousedOver||t.completeState==i.NotCompleted&&rules.Vec2.eq(n,e)||o.mouseOut(),t.completeState==i.NotCompleted&&o.markUnplayableReason(t.unplayableReason(n)),o.diesNextTurn=(null!=t.current.owners.get(n)||o.mousedOver&&(o.unplayableReason==rules.BoardFailureReason.DuplicateBoard||null==o.unplayableReason))&&null==r.owners.get(n),o})},e.prototype.unplayableReason=function(e){var t;return(t=rules.Board.play(this.current,e)).constructor==rules.Board?null:t},e.prototype.advanceTileStates=function(){var e=this;this.tileStates=this.tileStates.recreate(function(t){var r=e.tileStates.get(t);return r.advance(),r})},e.prototype.advanceUIGlobals=function(){this.completeState!=i.NotCompleted&&this.uiGlobals.completedTicks++,this.uiGlobals.clipSize*=1.12,this.uiGlobals.clipSize>1&&(this.uiGlobals.clipSize=1)},e}();e.UiModel=n;var o=function(){function e(e){this.canvas=e,this.newCanvas=document.createElement("canvas"),this.newCanvas.width=this.canvas.width,this.newCanvas.height=this.canvas.height,this.sizeRatio=this.canvas.getBoundingClientRect().width/this.canvas.width}return e}();e.DrawParts=o;var l=function(){function e(){}return e.view=function(t,r){r.canvas.getContext("2d").lineWidth=.8/r.sizeRatio,r.newCanvas.getContext("2d").lineWidth=.8/r.sizeRatio,r.canvas.getContext("2d").clearRect(0,0,r.newCanvas.width,r.newCanvas.height),e.drawBoard(t,i.NotCompleted,t.previous,r.canvas.getContext("2d"),r.canvas.width,r.canvas.height);var n=r.newCanvas.getContext("2d");n.clearRect(0,0,r.newCanvas.width,r.newCanvas.height),n.save();var o=new a(new rules.Vec2(r.newCanvas.width,r.newCanvas.height),t.previous.size),l=(o.usableDimensions(),t.uiGlobals.clipCenter.x*o.pixelSize.x),s=t.uiGlobals.clipCenter.y*o.pixelSize.y,u=t.uiGlobals.clipSize*Math.sqrt(Math.pow(o.pixelSize.x,2)+Math.pow(o.pixelSize.y,2));n.moveTo(l,s),n.beginPath(),n.arc(l,s,u,0,2*Math.PI),n.clip(),e.drawBoard(t,t.completeState,t.current,n,r.newCanvas.width,r.newCanvas.height),n.restore(),r.canvas.getContext("2d").drawImage(r.newCanvas,0,0)},e.drawBoard=function(r,i,n,o,l,s){var u=(r.tileStates,n.nextPlayer),c=t.forPlayerState(u,i);o.moveTo(0,0),o.beginPath(),o.rect(0,0,l,s),o.fillStyle=c.colorBg,o.fill(),o.closePath();var h=new a(new rules.Vec2(l,s),n.size),f=h.usableDimensions(),p=.1*Math.min(f.size.x,f.size.y),d=.01*Math.min(f.size.x,f.size.y),v=f.corner.x+d,y=f.corner.y+d,w=f.corner.x+f.size.x-d,S=f.corner.y+f.size.y-d,g=(v+w)/2,m=(y+S)/2;o.beginPath(),o.moveTo(g,y),o.arcTo(w,y,w,m,p),o.arcTo(w,S,g,S,p),o.arcTo(v,S,v,m,p),o.arcTo(v,y,g,y,p),o.arcTo(w,y,w,m,p),o.strokeStyle=c.strokeOuterBorder,o.stroke(),o.closePath();for(var P=0;P<n.size.x;P++)for(var b=0;b<n.size.y;b++){var k=h.toCellDimensions(new rules.Vec2(P,b));e.drawTile(r,n,u,c,e.specAt(new rules.Vec2(P,b),r,n,u),k.corner.x,k.corner.y,k.size.x,k.size.y,o)}document.title=n.title},e.specAt=function(e,t,r,i){var n=r.pies.get(e),o=r.owners.get(e),l=t.tileStates.get(e);return null!=l&&(null!=l.unplayableReason&&l.unplayableReason!=rules.BoardFailureReason.DuplicateBoard||!l.mousedOver||(o=i)),{vec:e,pie:n,owner:o,tileState:l}},e.drawTile=function(t,r,i,n,o,l,a,s,u,c){var h=2*Math.PI,f=l+s/2,p=a+u/2,d=Math.min(s,u)/2;d*=o.tileState.blowUp;var v=.65*d,y=.1*d,w=.25*d;if(null!=o.owner&&[[[1,0],[s,0]],[[0,-1],[0,-u]],[[-1,0],[-s,0]],[[0,1],[0,u]]].forEach(function(l){var a,s=l[0],u=s[0],h=s[1],v=l[1],y=v[0],w=v[1],S=new rules.Vec2(o.vec.x+u,o.vec.y+h),g=f+y,m=p+w,P=e.specAt(S,t,r,i),b=.35*d;if(a=null==P.tileState?b/o.tileState.blowUp:b/o.tileState.blowUp*P.tileState.blowUp,P.owner==o.owner){var k=Math.atan2(w,y);o.tileState.diesNextTurn?c.strokeStyle=n.strokePieSlice:c.strokeStyle=n.strokeFriendEdge,[-Math.PI/4,Math.PI/4].forEach(function(e){var t=k+e,r=k+Math.PI-e,i=f+Math.cos(t)*b,n=p+Math.sin(t)*b,o=g+Math.cos(r)*a,l=m+Math.sin(r)*a,s=(i+o)/2,u=(n+l)/2;c.beginPath(),c.moveTo(i,n),c.lineTo(s,u),c.stroke(),c.closePath()})}if(P.owner==rules.Players.opposite(o.owner)||null==P.tileState){var B=Math.atan2(m-p,g-f);c.strokeStyle=n.strokeEnemyEdge,c.moveTo(f,p),c.beginPath(),c.arc(f,p,b,B-Math.PI/4,B+Math.PI/4,!1),c.stroke(),c.closePath()}}),null!=o.pie)for(var S=0;S<o.pie.original;S++){var g=S>=o.pie.current,m=f+Math.cos((S+1)/o.pie.original*h+Math.PI/2)*v,P=p-Math.sin((S+1)/o.pie.original*h+Math.PI/2)*v;m+=o.tileState.jitterX*s,o.pie.current>0?(c.strokeStyle=n.strokePieSlice,g?c.fillStyle=n.fillPieSlice:c.fillStyle=n.colorBg):(c.fillStyle=n.strokeDeadPieSlice,c.strokeStyle=n.strokeDeadPieSlice);var b=S==o.pie.current-1&&null==o.tileState.unplayableReason&&o.tileState.mousedOver;b&&(P+=o.tileState.bounceY*y),c.moveTo(m,P),c.beginPath(),c.arc(m,P,y,0,h),c.fill(),c.closePath(),c.moveTo(m,P),c.beginPath(),c.arc(m,P,y,0,h),c.stroke(),c.closePath(),b&&(c.fillStyle=n.strokePieSlice,c.moveTo(m,P),c.beginPath(),c.arc(m,P,y/2,0,h),c.fill(),c.closePath())}null!=o.owner&&(o.owner==rules.Player.Black?(c.strokeStyle=n.strokeBlack,c.fillStyle=n.fillBlack):(c.strokeStyle=n.strokeWhite,c.fillStyle=n.fillWhite),c.moveTo(f,p),c.beginPath(),c.arc(f,p,w,0,h),c.fill(),c.stroke(),c.closePath()),o.tileState.diesNextTurn&&(c.strokeStyle=n.strokePieSlice,c.moveTo(f,p),c.beginPath(),c.moveTo(f-.2*w,p-.2*w),c.lineTo(f+.2*w,p+.2*w),c.moveTo(f+.2*w,p-.2*w),c.lineTo(f-.2*w,p+.2*w),c.stroke(),c.closePath());var k=.1*d;c.moveTo(f,p),c.beginPath(),null!=o.pie&&0==o.pie.current?(null==o.owner?(c.fillStyle=n.strokeDeadPieSlice,c.fillRect(f-k,p-k,2*k,2*k)):(c.strokeStyle=n.strokeDeadPieSlice,c.strokeRect(f-k,p-k,2*k,2*k)),c.closePath()):null==o.owner&&(c.fillStyle=n.strokeBlankSpot,c.fillRect(f-k,p-k,2*k,2*k),c.fill(),c.closePath())},e}();e.View=l;var a=function(){function e(e,t){this.pixelSize=e,this.cellSize=t}return e.prototype.usableDimensions=function(){var e=Math.min(this.pixelSize.x/this.cellSize.x,this.pixelSize.y/this.cellSize.y),t=e*this.cellSize.x,r=e*this.cellSize.y,i=(this.pixelSize.x-t)/2,n=(this.pixelSize.y-r)/2;return{corner:new rules.Vec2(i,n),size:new rules.Vec2(t,r)}},e.prototype.cellFor=function(e){var t=this.usableDimensions(),r=t.corner,i=t.size,n=(e.x-r.x)/i.x,o=(e.y-r.y)/i.y,l=Math.floor(n*this.cellSize.x),a=Math.floor(o*this.cellSize.y);return new rules.Vec2(l,a)},e.prototype.toCellDimensions=function(e){var t=this.usableDimensions(),r=t.corner,i=t.size;return{corner:new rules.Vec2(r.x+i.x/this.cellSize.x*e.x,r.y+i.y/this.cellSize.y*e.y),size:new rules.Vec2(i.x/this.cellSize.x,i.y/this.cellSize.y)}},e.prototype.regularize=function(e){var t=this.cellFor(e),r=this.toCellDimensions(t);return new rules.Vec2((r.corner.x+r.size.x/2)/this.pixelSize.x,(r.corner.y+r.size.y/2)/this.pixelSize.y)},e}();e.Layout=a}(uiModel||(uiModel={}));var boardBuilding;!function(e){e.loadBoard=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var i=t.length,n=t[0].length,o=new rules.Board(e,new rules.Vec2(n,i)),l=0;i>l;l++)for(var a=0;n>a;a++){var s=new rules.Vec2(a,l),u=t[l][a],c=u.charAt(0),h=u.charAt(1);switch(c){case"0":o.pies.unsafeSet(s,new rules.Pie(0,0));break;case"1":o.pies.unsafeSet(s,new rules.Pie(1,1));break;case"2":o.pies.unsafeSet(s,new rules.Pie(2,2));break;case"3":o.pies.unsafeSet(s,new rules.Pie(3,3));break;case"4":o.pies.unsafeSet(s,new rules.Pie(4,4));break;case"5":o.pies.unsafeSet(s,new rules.Pie(5,5));break;case"6":o.pies.unsafeSet(s,new rules.Pie(6,6));break;case"7":o.pies.unsafeSet(s,new rules.Pie(7,7));break;case"8":o.pies.unsafeSet(s,new rules.Pie(8,8));break;case"9":o.pies.unsafeSet(s,new rules.Pie(9,9));break;case"-":break;default:throw"invalid pie: "+c+JSON.stringify(t)}switch(h){case"B":o.owners.unsafeSet(s,rules.Player.Black);break;case"W":o.owners.unsafeSet(s,rules.Player.White);break;case"-":break;default:throw"invalid owner: "+h+JSON.stringify(t)}}return o}}(boardBuilding||(boardBuilding={}));var puzzles;!function(e){e.introduction=[boardBuilding.loadBoard("TUGH",["-W","0W","-W"],["-W","2-","-W"],["1-","0B","1-"]),boardBuilding.loadBoard("TUGB",["1W","2-","-B"],["1-","1-","-B"],["-B","-B","--"]),boardBuilding.loadBoard("TUGEC",["0B","-B","2W"],["0B","-B","1-"],["-B","1-","--"])]}(puzzles||(puzzles={}));var domCrap;!function(e){e.createGame=function(e,t){t=t.concat([]);var r,i,n,o=new uiModel.DrawParts(e),l=function(){var e=gen.Generator.generate(new rules.Vec2(6,3));e&&(r=e,i=new uiModel.UiModel(r),s())},a=function(){i=new uiModel.UiModel(r),s()},s=function(){e.style.position="fixed",n=new uiModel.Layout(new rules.Vec2(window.innerWidth,window.innerHeight),r.pies.size),e.style.left="0px",e.style.top="0px",e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px",e.width=window.innerWidth,e.height=window.innerHeight,o.newCanvas.width=window.innerWidth,o.newCanvas.height=window.innerHeight},u=function(){i.update("Tick"),uiModel.View.view(i,o),60==i.uiGlobals.completedTicks&&i.completeState==uiModel.CompleteState.Succeeded&&l(),180==i.uiGlobals.completedTicks&&i.completeState==uiModel.CompleteState.Failed&&a(),requestAnimationFrame(u)};e.addEventListener("mousemove",function(e){var t=new rules.Vec2(e.clientX,e.clientY),r=n.cellFor(t),o=n.regularize(t);i.update(["MouseOver",r,o])}),e.addEventListener("mousedown",function(e){var t=new rules.Vec2(e.clientX,e.clientY),r=n.cellFor(t),o=n.regularize(t);i.update(["Click",r,o])}),window.addEventListener("resize",function(e){return s()}),l(),u()}}(domCrap||(domCrap={}));</script> <style> #parent{ display:flex;justify-content:center;align-items:center;width:100%;height:100%;}#game{ position:fixed;}</style> </head> <body> <canvas id="game" width="1280px" height="1280px" style="width:640px;height:640px"> </canvas> <script type="text/javascript">domCrap.createGame(document.getElementById("game"),puzzles.introduction);</script> </body> </html>
